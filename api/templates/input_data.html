<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Input Tagihan - Seplit Bills</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/static/style.css">
    <meta charset="UTF-8">
    <link rel="apple-touch-icon" sizes="180x180" href="/static/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/static/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/static/favicon-16x16.png">
    <link rel="icon" type="image/x-icon" href="/static/favicon.ico">
</head>
<body>
    <header class="app-header">
        <img src="/static/Seplit Bills.png" alt="Logo Seplit Bills" class="app-logo">
        <p class="tagline">Split. Settle. Smile.</p>
    </header>

    <main class="container">
        <h1>Detail Tagihan</h1>
        <form action="/proses" method="post">
            <div class="form-section">
                <h2>Daftar Pesanan</h2>
                <div id="items-container">
                    <div class="item-row">
                        <input type="text" name="nama_item" class="input-field item-name" placeholder="Nama Item (cth: Kopi Susu)" required>
                        <input type="number" name="harga_item" class="input-field item-price" placeholder="Harga (cth: 20000)" required>
                        <button type="button" class="btn-delete item-delete-btn">×</button>
                    </div>
                </div>
                <button type="button" id="addItemBtn" class="btn btn-secondary">Tambah Item +</button>
            </div>
            <div class="form-section">
                <h2>Peserta</h2>
                <div class="participant-input-group">
                    <input type="text" id="participantNameInput" class="input-field" placeholder="Nama Peserta">
                    <button type="button" id="addParticipantBtn" class="btn btn-add">Add</button>
                </div>
                <div id="participants-list" class="tags-container"></div>
                <div id="hidden-participants"></div>
            </div>
            <button type="submit" class="btn btn-submit">Lanjutkan ke Pembagian</button>
        </form>
    </main>

    <footer class="app-footer">
        <a href="https://www.instagram.com/zaki.key" target="_blank" class="instagram-link">
            <svg class="instagram-logo" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="2" y="2" width="20" height="20" rx="5" ry="5"></rect><path d="M16 11.37A4 4 0 1 1 12.63 8 4 4 0 0 1 16 11.37z"></path><line x1="17.5" y1="6.5" x2="17.51" y2="6.5"></line></svg>
        </a>
        <p>Made by Zakikey</p>
        <p>© 2025. All Rights Reserved.</p>
    </footer>

    <script>
        // --- KODE JAVASCRIPT DIPERBARUI ---
        const itemsContainer = document.getElementById('items-container');
        const participantsList = document.getElementById('participants-list');
        const hiddenParticipantsContainer = document.getElementById('hidden-participants');
        
        // --- LOGIKA UNTUK ITEM ---
        document.getElementById('addItemBtn').addEventListener('click', () => {
            const newRow = document.createElement('div');
            newRow.className = 'item-row';
            // Tambahkan tombol hapus saat membuat baris baru
            newRow.innerHTML = `
                <input type="text" name="nama_item" class="input-field item-name" placeholder="Nama Item" required>
                <input type="number" name="harga_item" class="input-field item-price" placeholder="Harga" required>
                <button type="button" class="btn-delete item-delete-btn">×</button>
            `;
            itemsContainer.appendChild(newRow);
        });

        // Event listener untuk menghapus baris item
        itemsContainer.addEventListener('click', function(e) {
            // Cek apakah yang diklik adalah tombol hapus item
            if (e.target && e.target.classList.contains('item-delete-btn')) {
                // Hapus elemen .item-row yang merupakan induk dari tombol
                e.target.parentElement.remove();
            }
        });

        // --- LOGIKA UNTUK PESERTA ---
        const participants = new Set();
        document.getElementById('addParticipantBtn').addEventListener('click', () => {
            const participantNameInput = document.getElementById('participantNameInput');
            const name = participantNameInput.value.trim();
            
            if (name && !participants.has(name)) {
                participants.add(name);
                
                // Buat tag yang bisa dihapus
                const tag = document.createElement('span');
                tag.className = 'tag';
                tag.dataset.name = name; // Simpan nama di data-attribute
                tag.innerHTML = `${name} <span class="tag-delete-btn" data-name="${name}">×</span>`;
                participantsList.appendChild(tag);
                
                // Simpan di input tersembunyi
                const hiddenInput = document.createElement('input');
                hiddenInput.type = 'hidden';
                hiddenInput.name = 'peserta';
                hiddenInput.value = name;
                hiddenParticipantsContainer.appendChild(hiddenInput);

                participantNameInput.value = '';
            }
        });

        // Event listener untuk menghapus tag peserta
        participantsList.addEventListener('click', function(e) {
            if (e.target && e.target.classList.contains('tag-delete-btn')) {
                const nameToRemove = e.target.dataset.name;

                // 1. Hapus dari Set
                participants.delete(nameToRemove);

                // 2. Hapus input tersembunyi yang sesuai
                const hiddenInputToRemove = hiddenParticipantsContainer.querySelector(`input[value="${nameToRemove}"]`);
                if (hiddenInputToRemove) {
                    hiddenInputToRemove.remove();
                }

                // 3. Hapus elemen tag dari tampilan
                e.target.parentElement.remove();
            }
        });
    </script>
</body>
</html>